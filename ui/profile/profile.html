<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
    <script src="sidebar.js" defer></script>
    <link rel="stylesheet" href="default.css">
    <link rel="stylesheet" href="profile.css">
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
<sidebar-component></sidebar-component>
<main>
    <div id="nameWrapper">
        <h2 id="name"></h2>
        <i class="material-icons md-26 link" id="person">
            email
        </i>
    </div>
    <h3 id="type"></h3>
    <div id="description">
        <div class="shadow" id="leftWrapper">
            <div id="aboutWrapper">
                <h4>Über Mich</h4>
                <p id="about"></p>
            </div>
        </div>

        <div>
            <div class="shadow" id="rightWrapper">
                <div id="emailWrapper">
                    <h4 class="title">E-Mail</h4>
                    <p id="email"></p>
                </div>
                <div id="gitWrapper">
                    <h4>Git</h4>
                    <p id="git"></p>
                </div>

                <div id="stackWrapper">
                    <h4>Skills</h4>
                    <p id="stack"></p>
                </div>
            </div>

            <div class="shadow" id="ratingWrapper">
                <div id="contractsWrapper">
                    <h4 class="title">Alle Aufträge: <span id="contracts"></span></h4>
                </div>

                <div id="communicationWrapper">
                    <h4 class="title">Kommunikation: <span id="communication"></span></h4>
                </div>

                <div id="speedWrapper">
                    <h4 class="title">Schnelligkeit: <span id="speed"></span></h4>
                </div>

                <div id="qualityWrapper">
                    <h4 class="title">Qualität: <span id="quality"></span></h4>
                </div>
            </div>
        </div>

    </div>
</main>
<script type="module">
    import {getProfile, prettifySkill} from './profile.js';
    import {getContracts} from './contracts.js';
    import {redirect} from './session_manager.js';


    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('email')) {
        getProfile(urlParams.get('email'), (response) => {
            document.getElementById('name').innerText = response.username
            document.getElementById('email').innerText = response.email
            document.getElementById('type').innerText = response.type === 'client' ? 'Auftraggeber' : 'Entwickler'
            document.getElementById('about').innerText = response.about

            if (response.type === 'client') {
                $('#gitWrapper').remove()
                $('#stackWrapper').remove()
                $('#ratingWrapper').remove()
            } else {
                fillPastContracts(response.email)
                document.getElementById('stack').innerText = response.stack && response.stack.length > 0 ? response.stack.reduce((prev, skill) => prev + prettifySkill(skill) + '\n', '') : 'None'
                response.git ? document.getElementById('git').innerText = response.git : null
            }

            document.getElementById('person').onclick = () => {
                redirect(`/chat?email=${response.email}`)
            }

        }, (response) => console.error(response))
    }

    function fillPastContracts(email) {
        getContracts(email, (response) => {
            document.getElementById('contracts').innerText = response.amount
            document.getElementById('communication').innerText = response.rating[0] + '/5'
            document.getElementById('speed').innerText = response.rating[1] + '/5'
            document.getElementById('quality').innerText = response.rating[2] + '/5'

        }, (err) => {
            console.log(err)
        })
    }

</script>
</body>
</html>
