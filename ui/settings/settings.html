<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="stylesheet" href="default.css">
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="settings.css">
    <link rel="stylesheet" href="snackbar.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="sidebar.js" defer></script>
</head>
<body>
<sidebar-component></sidebar-component>
<main>
    <div id="welcome">
        <h2 id="user"></h2>
        <div>
            <i onclick="location.href='/settings'" class="material-icons md-26 link">settings</i>
            <i class="material-icons md-26 link" id="logout">logout</i>
        </div>
    </div>

    <div class="settings">
        <div>
            <form id="cname">
                <h3>Name</h3>
                <label for="name">Ändern</label>
                <input type="name" name="name" id="name"/>
                <label for="repname">Wiederholen</label>
                <input type="name" name="repname" id="repname"/>
                <button type="submit">Speichern</button>
            </form>
        </div>

        <div>
            <form id="cemail">
                <h3>E-Mail</h3>
                <label for="email">Ändern</label>
                <input type="email" name="email" id="email"/>
                <label for="repemail">Wiederholen</label>
                <input type="email" name="repemail" id="repemail"/>
                <button type="submit">Speichern</button>
            </form>
        </div>

        <div>
            <form id="cpassword">
                <h3>Passwort</h3>
                <label for="password">Ändern</label>
                <input type="password" name="password" id="password"/>
                <label for="reppassword">Wiederholen</label>
                <input type="password" name="reppassword" id="reppassword"/>
                <button type="submit">Speichern</button>
            </form>
        </div>

    </div>
</main>

<script type="module">
    import {checkSession} from './check_session.js';
    import {unauthorize, changeAttribute} from './session_manager.js';
    import {callSnackbar} from './snackbar.js';

    var x = document.getElementById("logout");
    x.addEventListener("click", unauthorize);

    function updateHeader() {
        var x = document.getElementById("user");
        x.innerText = "Hallo " + sessionStorage.getItem("username");

        x = document.getElementById("welcome");
        x.style.visibility = 'visible';
        x.addEventListener("click", unauthorize);

        document.getElementById("name").value = sessionStorage.getItem(("username"));
        document.getElementById("email").value = sessionStorage.getItem(("email"));
        document.getElementById("password").value = sessionStorage.getItem(("password"));
    }

    checkSession(updateHeader, unauthorize);

    x = document.getElementById('cname');
    x.addEventListener("submit", handleSubmitChange);

    x = document.getElementById("cemail");
    x.addEventListener("submit", (event) => handleSubmitChange(event, 'email'));

    x = document.getElementById("cpassword");
    x.addEventListener("submit", (event) => handleSubmitChange(event, 'password'));


    function handleSubmitChange(event, type = 'name') {
        event.preventDefault();
        const data = new FormData(event.target);
        const inputData = data.get(type);
        const repInputData = data.get('rep' + type);

        if (inputData === repInputData) {
            switch (type) {
                case 'name':
                    changeAttribute({username: inputData}, updateHeader)
                    break;
                case 'email':
                    changeAttribute({email: inputData}, updateHeader)
                    break;
                case 'password':
                    changeAttribute({password: inputData})
                    break;
            }
        } else callSnackbar('Datenfelder stimmen nicht überein')
    }
</script>

<div id="snackbar"></div>
</body>
</html>
